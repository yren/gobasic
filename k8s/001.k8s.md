
## docker 

docker container 本质上是个受限的 process, 通过 namespace (修改进程视图) , Cgroups (限制资源), rootfs (文件系统)

容器技术的核心，通过约束和修改进程的动态表现，为其创造出一个边界。 

容器较虚拟机更敏捷和高性能，但是隔离不彻底。容器本质是进程使用同一宿主机操作系统内核。内核中很多资源不能被 namspace 化，比如: 时间。

Cgroups 全称 linux control group, 限制一个进程组能使用的资源上限，cpu, 内存，磁盘，网络带宽等。

container 是一个 单进程模型，用户进程 PID=1, 也是后续进程的父进程. 

/proc 文件系统问题， top 查看的是 /proc 宿主机的 cpu, 内存信息。原因 /proc 不知道 cgroups 限制的存在。 容器用 lxcfs 读取。将
/var/lib/lxcfs/proc 挂载到 容器的 /proc 下。

rootfs 包含文件，配置和目录，不包括操作系统内核。linux 中这两部分是分开存放的。操作系统在开机时加载指定版本的内核镜像。

rootfs 打包的不止是应用，包括操作系统的文件和目录，实现了 container 的一致性。 docker 的 rootfs 引入了层的概念 (layer), 用了联合
文件系统 (union file system). 将多个不同位置的目录挂载到同一位置下。

只读层 + Init 层 + 可读写层

删除只读层的文件， AuFS 在读写层建一个 whiteout 文件，遮挡住只读层的文件。删除文件 foo, 会建一个 .wh.foo 文件

Init 层夹在 只读层 和 读写层之间，用来存放 /etc/hosts, /etc/resolv.conf 等信息